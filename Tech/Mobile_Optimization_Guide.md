# ğŸ“± ç§»åŠ¨ç«¯æ·±åº¦ä¼˜åŒ–æŒ‡å— (Mobile Optimization Guide)

**æ–‡æ¡£ç›®æ ‡ï¼š** è®© Vampirefall åœ¨ iPhone 8 / å°ç±³ 6 çº§åˆ«çš„è®¾å¤‡ä¸Šç¨³å®šè¿è¡Œï¼Œä¸”**ä¸çƒ«æ‰‹**ã€‚
**æ ¸å¿ƒçŸ›ç›¾ï¼š** å¡”é˜²çš„æµ·é‡å•ä½ vs æ‰‹æœºå¯æ€œçš„æ•£çƒ­èƒ½åŠ›ã€‚

---

## 1. ğŸ”¥ å‘çƒ­æ§åˆ¶ï¼šä½ çš„æ¸¸æˆä¸ºä»€ä¹ˆçƒ«æ‰‹ï¼Ÿ

æ‰‹æœºå‘çƒ­ä¸»è¦æºäº **GPU è´Ÿè½½æŒç»­è¿‡é«˜** å’Œ **CPU å¯†é›†è¿ç®—**ã€‚ä¸€æ—¦å‘çƒ­ï¼Œç³»ç»Ÿå¼ºåˆ¶é™é¢‘ï¼Œå¸§ç‡ä» 60 ç¬é—´è·Œåˆ° 15ã€‚

### 1.1 å¸§ç‡å°é¡¶ (Target Frame Rate)
*   **èœå•/UIç•Œé¢:** å¼ºåˆ¶é”å®š **30 FPS**ã€‚æ²¡äººéœ€è¦åœ¨èƒŒåŒ…ç•Œé¢çœ‹ 60 å¸§çš„åŠ¨ç”»ã€‚
*   **æˆ˜æ–—ç•Œé¢:** é»˜è®¤ **30 FPS**ã€‚æä¾› "é«˜å¸§ç‡æ¨¡å¼ (60 FPS)" å¼€å…³ï¼Œä½†é»˜è®¤å…³é—­ã€‚
    *   *ç†ç”±:* 30 FPS èƒ½èŠ‚çœ 40% çš„ç”µé‡ï¼Œå¤§å¹…å»¶ç¼“å‘çƒ­ã€‚

### 1.2 åŠ¨æ€åˆ†è¾¨ç‡ (Dynamic Resolution)
*   **åŸç†:** å½“æ£€æµ‹åˆ° GPU å‹åŠ›å¤§æ—¶ï¼Œè‡ªåŠ¨é™ä½æ¸²æŸ“åˆ†è¾¨ç‡ï¼ŒUI ä¿æŒé«˜æ¸…ã€‚
*   **Unityè®¾ç½®:** `URP Asset -> Render Scale`.
*   **è‡ªé€‚åº”è„šæœ¬:**
    ```csharp
    void Update() {
        if (Time.deltaTime > 0.04f) { // ä½äº 25 FPS
            currentScale = Mathf.Max(0.7f, currentScale - 0.05f);
            URPAsset.renderScale = currentScale;
        }
    }
    ```
*   **æ•ˆæœ:** æ‰‹æœºç”¨æˆ·é€šå¸¸çœ‹ä¸å‡º 1080p å’Œ 720p çš„åŒºåˆ«ï¼Œä½† GPU è´Ÿè½½å‡åŠã€‚

### 1.3 ç‰©ç†é™é¢‘ (Physics Throttling)
*   **é»˜è®¤:** `FixedTimestep = 0.02` (50Hz)ã€‚
*   **ä¼˜åŒ–:** å¡”é˜²æ¸¸æˆä¸éœ€è¦é‚£ä¹ˆç²¾ç¡®çš„ç¢°æ’ã€‚æ”¹ä¸º **0.04 (25Hz)** ç”šè‡³ **0.05 (20Hz)**ã€‚
*   *æ”¶ç›Š:* CPU ç‰©ç†è®¡ç®—å¼€é”€ç›´æ¥å‡åŠã€‚

---

## 2. ğŸ“¦ åŒ…ä½“ç˜¦èº« (App Size Optimization)

ç›®æ ‡ï¼šAPK < 100MB (ä¸å«èµ„æºçƒ­æ›´)ï¼Œé¦–åŒ…è¶Šå°ï¼Œè½¬åŒ–ç‡è¶Šé«˜ã€‚

### 2.1 çº¹ç†å‹ç¼© (Texture Compression)
è¿™æ˜¯åŒ…ä½“çš„å¤§å¤´ã€‚
*   **Android:** å¿…é¡»å¼ºåˆ¶å…¨å‘˜ **ASTC 6x6** (ç”šè‡³ 8x8)ã€‚
    *   *å¯¹æ¯”:* ETC2 è´¨é‡å·®ï¼ŒASTC è´¨é‡å¥½ä¸”å‹ç¼©ç‡é«˜ã€‚æ‰€æœ‰ 2016 å¹´åçš„å®‰å“æœºéƒ½æ”¯æŒã€‚
*   **iOS:** **ASTC 6x6**ã€‚
*   **ç¦å¿Œ:** ä¸¥ç¦ä½¿ç”¨ RGBA32 æˆ– PNG åŸå›¾è¿›åŒ…ã€‚

### 2.2 ä»£ç è£å‰ª (Code Stripping)
*   **è®¾ç½®:** `Player Settings -> Managed Stripping Level -> High`.
*   **åŸç†:** Unity ä¼šè‡ªåŠ¨å‰”é™¤é‚£äº›ä½ æ²¡ç”¨åˆ°çš„ C# åº“ä»£ç ã€‚
*   **é£é™©:** åå°„ (Reflection) å¯èƒ½ä¼šå¤±æ•ˆã€‚å¦‚æœç”¨äº† JSON åº“æˆ– Luaï¼Œéœ€è¦é…ç½® `link.xml` ç™½åå•ã€‚

### 2.3 éŸ³é¢‘è®¾ç½®
*   **BGM:** å¼ºåˆ¶å•å£°é“ (Force to Mono)ï¼Œç ç‡ 96kbps (Vorbis)ã€‚æ‰‹æœºå¤–æ”¾å¬ä¸å‡º 192kbps çš„åŒºåˆ«ã€‚
*   **SFX:** çŸ­éŸ³æ•ˆç ç‡ 70kbps (ADPCM)ã€‚

---

## 3. ğŸ§± å†…å­˜é˜²çˆ†ï¼š2GB å†…å­˜ç”Ÿå­˜æŒ‡å—

Android ä½ç«¯æœºåªæœ‰ 2GB å†…å­˜ï¼Œé™¤å»ç³»ç»Ÿï¼Œåˆ†ç»™æ¸¸æˆçš„åªæœ‰ 500MB - 700MBã€‚

### 3.1 çº¹ç†æµé€ (Texture Streaming)
*   **è®¾ç½®:** `Quality -> Texture Streaming`.
*   **åŸç†:** æ¸¸æˆå¯åŠ¨æ—¶åªåŠ è½½ 1/8 å°ºå¯¸çš„æ¨¡ç³Šè´´å›¾ã€‚å½“æ‘„åƒæœºé è¿‘ç‰©ä½“æ—¶ï¼Œæ‰åŠ è½½é«˜æ¸…è´´å›¾ã€‚
*   **æ”¶ç›Š:** æ˜¾å­˜å ç”¨å‡å°‘ 60%~80%ã€‚

### 3.2 æœç» Resources
*   å†æ¬¡å¼ºè°ƒï¼Œä¸è¦æŠŠå¤§å›¾æ”¾ Resourcesã€‚
*   **Addressables Duplicate Check:** ä½¿ç”¨ Addressables çš„åˆ†æå·¥å…·æ£€æŸ¥æœ‰æ²¡æœ‰èµ„æºè¢«æ‰“è¿›äº†å¤šä¸ªåŒ…é‡Œ (Duplicated Assets)ã€‚

### 3.3 Shader å˜ä½“çˆ†ç‚¸
*   **ç°è±¡:** å†…å­˜é‡ŒåŠ è½½äº†å‡ å MB çš„ Shader Labã€‚
*   **åŸå› :** URP çš„ Shader åŒ…å«æˆåƒä¸Šä¸‡ä¸ªå˜ä½“ (Variants)ã€‚
*   **å¯¹ç­–:** ä½¿ç”¨ `Strip URPS` è„šæœ¬ï¼Œå‰”é™¤æ‰ä½ æ²¡ç”¨åˆ°çš„å˜ä½“ï¼ˆæ¯”å¦‚ä½ æ²¡ç”¨ç‚¹å…‰æºé˜´å½±ï¼Œå°±å‰”é™¤ Additional Light Shadow å˜ä½“ï¼‰ã€‚

---

## 4. ğŸ¤– ä¸“é¡¹ï¼šæµ·é‡å•ä½ä¼˜åŒ– (DOTS / GPU Instancing)

### 4.1 GPU Instancing
*   **æè´¨è®¾ç½®:** æ‰€æœ‰æ€ªç‰©çš„æè´¨çƒå¿…é¡»å‹¾é€‰ **Enable GPU Instancing**ã€‚
*   **æ¡ä»¶:** åªæœ‰ä½¿ç”¨**ç›¸åŒ Mesh** å’Œ **ç›¸åŒ Material** çš„ç‰©ä½“æ‰èƒ½åˆæ‰¹ã€‚
*   **æŠ€å·§ (Property Block):** 
    *   å¦‚æœæƒ³æ”¹å˜æ€ªç‰©é¢œè‰²ï¼ˆå¦‚å—å‡»å˜çº¢ï¼‰ï¼Œ**åƒä¸‡ä¸è¦** `material.color = red` (è¿™ä¼šç ´ååˆæ‰¹)ã€‚
    *   **å¿…é¡»ä½¿ç”¨** `MaterialPropertyBlock`ï¼š
    ```csharp
    block.SetColor("_BaseColor", Color.red);
    renderer.SetPropertyBlock(block);
    ```

### 4.2 åŠ¨ç”»çƒ˜ç„™ (Texture Skinning)
*   **ç—›ç‚¹:** 500 ä¸ªæ€ªç‰©çš„ `SkinnedMeshRenderer` è®¡ç®—éª¨éª¼æå…¶è€— CPUã€‚
*   **è§£æ³•:** ä½¿ç”¨ **Animation Instancing** (GitHub æœ‰å¼€æºåº“)ã€‚
    *   åŸç†: æŠŠåŠ¨ç”»å¸§çƒ˜ç„™æˆä¸€å¼ çº¹ç† (Animation Texture)ã€‚
    *   è¿è¡Œ: GPU è¯»å–çº¹ç†æ¥ç§»åŠ¨é¡¶ç‚¹ã€‚CPU å¼€é”€å‡ ä¹ä¸º 0ã€‚

---

## 5. ğŸ“ ä¼˜åŒ–æ£€æŸ¥æ¸…å• (Pre-Launch Checklist)

*   [ ] **Scripting Backend:** å¿…é¡»æ˜¯ **IL2CPP** (ARM64)ã€‚ä¸è¦ç”¨ Monoã€‚
*   [ ] **Target Architectures:** Android å‹¾é€‰ ARM64ï¼Œå–æ¶ˆ ARMv7 (Google Play è¦æ±‚ï¼Œä¸” v7 æ€§èƒ½å·®)ã€‚
*   [ ] **Multithreaded Rendering:** å¿…é¡»å‹¾é€‰ã€‚
*   [ ] **V-Sync:** å…³é—­ (åœ¨ä»£ç é‡Œæ‰‹åŠ¨é™å¸§ï¼Œæ›´å¯æ§)ã€‚
*   [ ] **Accelerometer Frequency:** å¦‚æœä¸ç©é‡åŠ›æ„Ÿåº”ï¼Œè®¾ä¸º Disabledï¼Œçœç”µã€‚
