# âš”ï¸ æˆ˜æ–—ç³»ç»Ÿè¯¦è§£ (Combat System Mechanics)

æœ¬æ–‡æ¡£å®šä¹‰äº† Project Vampirefall çš„æ ¸å¿ƒæˆ˜æ–—è§„åˆ™ï¼ŒåŒ…æ‹¬ä¼¤å®³è®¡ç®—æµç¨‹ã€å±æ€§ç›¸äº’ä½œç”¨ã€å¼‚å¸¸çŠ¶æ€åŠæ§åˆ¶æœºåˆ¶ã€‚

> **è®¾è®¡å“²å­¦**: æœ¬ç³»ç»Ÿçš„æ ¸å¿ƒç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ª**æ·±åº¦å¯æ‰©å±•**çš„æ•°å€¼æ¡†æ¶ï¼Œé€šè¿‡**ä¹˜åŒºç†è®º**å’Œ**çŠ¶æ€æœº**åˆ›é€ å¤šæ ·åŒ–çš„ Build ä½“éªŒï¼ŒåŒæ—¶é€šè¿‡**éŸ§æ€§**å’Œ**åé¦ˆç³»ç»Ÿ**ä¿è¯åŠ¨ä½œæ¸¸æˆçš„çˆ½å¿«æ„Ÿã€‚

---

## 1. ä¼¤å®³ç±»å‹ä¸æŠ—æ€§ (Damage Types & Resistances)

### 1.1 æ ¸å¿ƒä¼¤å®³ç±»å‹
ä¸ºäº†ä¿è¯æˆ˜æ–—ç­–ç•¥çš„æ·±åº¦ï¼Œæˆ‘ä»¬é‡‡ç”¨ç»å…¸çš„â€œä¸‰ç³»â€åˆ†ç±»ã€‚

*   **ç‰©ç† (Physical)**: åŸºç¡€ä¼¤å®³é«˜ï¼Œå—**æŠ¤ç”² (Armor)** å‡å…ã€‚
*   **å…ƒç´  (Elemental)**: é™„å¸¦å¼‚å¸¸çŠ¶æ€ï¼Œå—**å…ƒç´ æŠ—æ€§ (Resistance)** å‡å…ã€‚
    *   ğŸ”¥ **ç«ç„° (Fire)**: çº¯ä¼¤å®³ / DoTã€‚
    *   â„ï¸ **å†°éœœ (Cold)**: æ§åˆ¶ / å‡é€Ÿã€‚
    *   âš¡ **é›·ç”µ (Lightning)**: ç¾¤ä½“ / æ˜“ä¼¤ã€‚
*   **æ··æ²Œ (Chaos)**: ç¨€æœ‰ä¼¤å®³ï¼Œæ— è§†èƒ½é‡æŠ¤ç›¾ (Energy Shield)ï¼Œå—**æ··æ²ŒæŠ—æ€§**å‡å…ã€‚

### 1.2 ğŸ§  æ ¸å¿ƒç†è®ºï¼šä¹˜åŒºç†è®º (Bucket Theory)

å¼•ç”¨è‡ª PoE ä¸ Diablo çš„æ•°å€¼åŸºçŸ³ï¼Œä¼¤å®³è®¡ç®—éµå¾ª**ä¹˜åŒºç†è®º**ä»¥é˜²æ­¢æ•°å€¼å¤±æ§å¹¶æä¾›ç­–ç•¥æ·±åº¦ã€‚

**æœ€ç»ˆä¼¤å®³ = åŸºç¡€ä¼¤å®³ Ã— å¢ä¼¤åŒº(Inc) Ã— ç‹¬ç«‹ä¹˜åŒº(More) Ã— æš´å‡»åŒº Ã— æŠ—æ€§åŒº**

1.  **åŸºç¡€åŒº (Base)**: æŠ€èƒ½é¢æ¿ Ã— æ­¦å™¨ä¼¤å®³ã€‚
2.  **å¢ä¼¤åŒº (Additive / Inc)**: `(1 + ç‰©ç†ä¼¤% + å…¨ä¼¤% + è¿‘æˆ˜ä¼¤%)`ã€‚æ‰€æœ‰æ­¤ç±»è¯æ¡ç›¸åŠ ã€‚
    *   *è®¾è®¡æ„å›¾*: éšç€æ•°å€¼å †å ï¼Œæ”¶ç›Šäº§ç”Ÿ**ç¨€é‡Šæ•ˆåº”**ã€‚
3.  **ç‹¬ç«‹ä¹˜åŒº (Multiplicative / More)**: `(1 + é¢å¤–ä¼¤A) Ã— (1 + é¢å¤–ä¼¤B)`ã€‚
    *   *è®¾è®¡æ„å›¾*: æå…¶çè´µï¼Œæ— ç¨€é‡Šï¼Œæ˜¯åæœŸ Build çš„æ ¸å¿ƒè¿½æ±‚ã€‚
4.  **æŠ—æ€§åŒº (Resistance)**: `(1 - (ç›®æ ‡æŠ—æ€§ - ç©¿é€))`ã€‚

> **ğŸ’¡ ä¸šç•Œæ¡ˆä¾‹ (Path of Exile)**: PoE çš„æˆåŠŸåœ¨äºé€šè¿‡å¤§é‡çš„ "Inc" è¯æ¡è®©æ–°æ‰‹è·å¾—ç¨³å®šæˆé•¿ï¼ŒåŒæ—¶ç”¨ç¨€æœ‰çš„ "More" è¯æ¡å¥–åŠ±æ·±åº¦ç©å®¶ï¼Œåˆ›é€ äº†æé«˜çš„ Build ä¸Šé™ã€‚

### 1.3 æ ¸å¿ƒå…¬å¼

#### ç‰©ç†æŠ¤ç”² (Armor) - çº¿æ€§æœ‰æ•ˆç”Ÿå‘½å€¼
```csharp
// æŠ¤ç”²å‡ä¼¤å…¬å¼ (DR)
// K ä¸ºå¸¸æ•° (æ¨è 3000)ï¼Œå†³å®šäº†å‡ä¼¤æ›²çº¿çš„é™¡å³­ç¨‹åº¦
float damageReduction = Armor / (Armor + K);
```
*   *åŸç†*: è™½ç„¶ DR éšæŠ¤ç”²å¢åŠ è€Œé€’å‡ï¼Œä½† **æœ‰æ•ˆç”Ÿå‘½å€¼ (EHP)** ä¿æŒçº¿æ€§å¢é•¿ã€‚æ¯ K ç‚¹æŠ¤ç”²ï¼ŒEHP å¢åŠ  100%ã€‚

#### å…ƒç´ æŠ—æ€§ (Resistance) - ç¡¬ä¸Šé™
```csharp
// æŠ—æ€§è®¡ç®—
// ç©¿é€ (Penetration) ç›´æ¥åšå‡æ³•
float finalRes = Mathf.Min(TargetRes - AttackerPen, MaxResCap); // MaxResCap é€šå¸¸ä¸º 75%
float multiplier = 1.0f - finalRes;
```

---

## 2. å¼‚å¸¸çŠ¶æ€ (Status Ailments)

### 2.1 çŠ¶æ€ä½“ç³»
| çŠ¶æ€ | æ¥æº | æ•ˆæœå®šä½ | æ ¸å¿ƒæœºåˆ¶ |
| :--- | :--- | :--- | :--- |
| **ç‚¹ç‡ƒ (Ignite)** | ğŸ”¥ ç«ç„° | æŒç»­è¾“å‡º | **å¿«ç…§æœºåˆ¶**: ä¼¤å®³åŸºäºè§¦å‘æ—¶çš„å•æ¬¡å‡»ä¸­ä¼¤å®³ã€‚ä¸å¯å åŠ ï¼Œåªå–æœ€é«˜ã€‚ |
| **å†°ç¼“/å†»ç»“ (Chill/Freeze)** | â„ï¸ å†°éœœ | æ§åœº/çª—å£ | **é˜ˆå€¼æœºåˆ¶**: æ•ˆæœå–å†³äºä¼¤å®³å ç›®æ ‡ MaxHP çš„æ¯”ä¾‹ã€‚ |
| **æ„Ÿç”µ (Shock)** | âš¡ é›·ç”µ | æ˜“ä¼¤/çˆ†å‘ | **å›¢é˜Ÿå…±äº«**: å¢åŠ ç›®æ ‡å—åˆ°çš„æ‰€æœ‰ä¼¤å®³ (ç‹¬ç«‹ä¹˜åŒº)ã€‚ |
| **æµè¡€ (Bleed)** | âš”ï¸ ç‰©ç† | ç§»åŠ¨æƒ©ç½š | **åŠ¨æ€åˆ¤å®š**: ç›®æ ‡ç§»åŠ¨æ—¶å—åˆ°é¢å¤– 200% ä¼¤å®³ã€‚ |

### 2.2 ğŸ§  æ ¸å¿ƒç®—æ³•ï¼šä¼ªéšæœºåˆ†å¸ƒ (PRD)

ä¸ºäº†é¿å…â€œè„¸é»‘â€å¯¼è‡´çš„ä½“éªŒæ–­å±‚ï¼Œæ‰€æœ‰æ¦‚ç‡è§¦å‘çš„çŠ¶æ€ï¼ˆå¦‚æš´å‡»ã€å¼‚å¸¸ï¼‰**å¿…é¡»**ä½¿ç”¨ PRD ç®—æ³•ã€‚

> **PRD åŸç†**: æ¯æ¬¡è§¦å‘å¤±è´¥ï¼Œä¸‹æ¬¡è§¦å‘æ¦‚ç‡æå‡ï¼›è§¦å‘æˆåŠŸï¼Œæ¦‚ç‡é‡ç½®ã€‚
> *å‚è§: `Tech/Algorithms/Roguelike_RNG_Systems.md`*

```csharp
// ä¼ªä»£ç é€»è¾‘
class PRDCounter {
    float C; // åŸºç¡€æ¦‚ç‡å¯¹åº”çš„å¢é‡å¸¸æ•°
    int N = 1; // å¤±è´¥è®¡æ•°å™¨

    bool Check(float baseChance) {
        if (Random.value < C * N) {
            N = 1; return true;
        } else {
            N++; return false;
        }
    }
}
```

---

## 3. ç¡¬ç›´ä¸éŸ§æ€§ (Stagger & Poise)

å¼•å…¥ç±»ä¼¼ã€Šé»‘æš—ä¹‹é­‚ã€‹çš„éŸ§æ€§ç³»ç»Ÿï¼Œèµ‹äºˆæˆ˜æ–—â€œé‡é‡æ„Ÿâ€å’Œâ€œèŠ‚å¥æ„Ÿâ€ã€‚

### 3.1 éŸ§æ€§æœºåˆ¶
1.  **éŸ§æ€§æ¡ (Poise Bar)**: æ‰€æœ‰å•ä½æ‹¥æœ‰çš„éšè—å±æ€§ã€‚
2.  **å‰ŠéŸ§ (Poise Damage)**: æ”»å‡»ä¼šæ‰£é™¤éŸ§æ€§ã€‚`éŸ§æ€§ä¼¤å®³ = ä¼¤å®³ Ã— å†²å‡»ç³»æ•°`ã€‚
3.  **ç¡¬ç›´ (Stagger)**: å½“éŸ§æ€§ <= 0 æ—¶ï¼Œå•ä½è¿›å…¥ç¡¬ç›´çŠ¶æ€ï¼ŒåŠ¨ä½œè¢«æ‰“æ–­ï¼Œå—å‡»åŠ¨ç”»æ’­æ”¾ã€‚
4.  **æ¢å¤**: è‹¥ä¸€æ®µæ—¶é—´æœªå—å‡»ï¼ŒéŸ§æ€§å¼€å§‹å¿«é€Ÿæ¢å¤ã€‚

### 3.2 ğŸ§  è®¾è®¡å“²å­¦ï¼šèŠ‚å¥æ§åˆ¶
éŸ§æ€§ç³»ç»Ÿä¸ä»…ä»…æ˜¯é˜²å¾¡å±æ€§ï¼Œæ›´æ˜¯**æˆ˜æ–—èŠ‚å¥**çš„æ§åˆ¶å™¨ã€‚
*   **ç©å®¶ç­–ç•¥**: å¿…é¡»åœ¨ Boss æ¢å¤éŸ§æ€§å‰ä¿æŒæ”»åŠ¿ï¼ˆè´ªåˆ€çš„é£é™©ï¼‰ã€‚
*   **Boss è®¾è®¡**: é«˜éŸ§æ€§é˜²æ­¢è¢«ç©å®¶æ— é™è¿å‡»æ§åˆ¶ï¼Œä½†ç ´éŸ§åæä¾›å·¨å¤§çš„è¾“å‡ºçª—å£ (Reward)ã€‚

### 3.3 æ ¸å¿ƒé€»è¾‘ç¤ºä¾‹

```csharp
// éŸ§æ€§ä¼¤å®³å¤„ç†æ ¸å¿ƒé€»è¾‘
void TakePoiseDamage(float amount, bool hasForce) {
    if (isStaggered) return; // ç¡¬ç›´ä¸­ä¸é‡å¤è®¡ç®—

    currentPoise -= amount;
    resetRecoveryTimer(); // é‡ç½®æ¢å¤è®¡æ—¶å™¨

    if (currentPoise <= 0) {
        TriggerStagger(); // è§¦å‘ç¡¬ç›´
        if (hasForce) ApplyKnockback(); // ä»…åœ¨ç ´éŸ§æ—¶è§¦å‘å‡»é€€
    }
}
```

> **ğŸ’¡ ä¸šç•Œæ¡ˆä¾‹ (Dark Souls)**: é­‚ç³»åˆ—é€šè¿‡éšè—çš„éŸ§æ€§æ•°å€¼å’Œåˆ†çº§çš„ç¡¬ç›´åŠ¨ç”»ï¼ˆå°/ä¸­/å¤§ï¼‰ï¼Œåˆ›é€ äº†ç²¾ç¡®çš„æ‰“å‡»åé¦ˆã€‚æˆ‘ä»¬éœ€è¦ç®€åŒ–æ­¤ç³»ç»Ÿï¼Œä½¿å…¶é€‚åº”å¿«èŠ‚å¥çš„å¡”é˜²æˆ˜æ–—ã€‚

---

## 4. ä»‡æ¨ç³»ç»Ÿ (Aggro System)

ç”±äºæ··åˆäº†å¡”é˜²å…ƒç´ ï¼Œæ€ªç‰©çš„ä»‡æ¨é€»è¾‘éœ€è¦å¹³è¡¡â€œæ”»å‡»ç©å®¶â€å’Œâ€œæ”»å‡»å¡”/åŸºåœ°â€ã€‚

### 4.1 ä¼˜å…ˆçº§å †æ ˆ
1.  **å¼ºåˆ¶å˜²è®½ (Taunt)**: èƒ½å¤Ÿå¼ºåˆ¶è¦†ç›–æ‰€æœ‰é€»è¾‘ï¼ˆæŒç»­ 3sï¼‰ã€‚
2.  **è·¯å¾„é˜»æŒ¡**: è‹¥å»å¾€åŸºåœ°çš„è·¯è¢«å µæ­»ï¼Œæ”»å‡»é˜»æŒ¡ç‰©ï¼ˆç ´å¢™ï¼‰ã€‚
3.  **åŠ¨æ€æƒé‡**: åŸºäºä¼¤å®³å’Œè·ç¦»çš„åŠ æƒè®¡ç®—ã€‚

### 4.2 ğŸ§  æƒé‡å…¬å¼
`AggroScore = (Damage_Dealt_Recent * Weight_Dmg) + (1 / Distance * Weight_Dist)`

*   **è¿‘æˆ˜æ€ª**: è·ç¦»æƒé‡æé«˜ï¼ˆä¼˜å…ˆæ‰“è„¸ä¸Šçš„ï¼‰ã€‚
*   **è¿œç¨‹æ€ª**: è·ç¦»æƒé‡è¾ƒä½ï¼Œå€¾å‘äºæ”»å‡»é«˜å¨èƒç›®æ ‡ï¼ˆå¦‚è¾“å‡ºå¡”ï¼‰ã€‚
*   **æ»åé˜ˆå€¼ (Hysteresis)**: åªæœ‰æ–°ç›®æ ‡çš„ä»‡æ¨å€¼è¶…è¿‡å½“å‰ç›®æ ‡ **110%** æ—¶æ‰åˆ‡æ¢ï¼Œé˜²æ­¢ç›®æ ‡é¢‘ç¹æŠ–åŠ¨ã€‚

---

## 5. è¿å‡»ä¸è¯„åˆ† (Combo & Style)

### 5.1 è¿å‡»è®¾è®¡
è¿å‡»ä¸ä»…æ˜¯æ•°å­—ï¼Œæ›´æ˜¯**èµ„æºè·å–æ•ˆç‡**çš„å€å¢å™¨ã€‚

*   **æ—¶é—´çª—å£**: 3ç§’ã€‚éšè¿å‡»æ•°å¢åŠ ï¼Œçª—å£å¯ç•¥å¾®æ”¾å®½ã€‚
*   **ä¸­æ–­æƒ©ç½š**: è¢«ç¡¬ç›´æ‰“å‡» (Stagger) ä¼šç›´æ¥æ¸…ç©ºè¿å‡»ã€‚è¿™é¼“åŠ±ç©å®¶åœ¨è¿›æ”»çš„åŒæ—¶ä¿æŒèµ°ä½ã€‚

### 5.2 é˜¶æ®µå¥–åŠ±
*   **Phase 1 (10 Hit)**: ç§»é€Ÿæå‡ï¼ˆä¼˜åŒ–èµ°ä½ï¼‰ã€‚
*   **Phase 2 (50 Hit)**: æ”»é€Ÿ/èµ„æºè·å–æå‡ï¼ˆåŠ é€Ÿå¾ªç¯ï¼‰ã€‚
*   **Phase 3 (100 Hit)**: ç‹¬ç«‹å¢ä¼¤ + è§†è§‰ç‰¹æ•ˆï¼ˆç”µå¼§/æ®‹å½±ï¼‰ã€‚

> **ğŸ’¡ ä¸šç•Œæ¡ˆä¾‹ (Devil May Cry)**: é¬¼æ³£çš„ Style ç³»ç»Ÿé¼“åŠ±èŠ±æ ·è¿›æ”»ã€‚åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­ï¼Œè¿å‡»ä¸»è¦ä½œä¸º**â€œé«˜é£é™©é«˜å›æŠ¥â€**çš„çŠ¶æ€ï¼Œå¥–åŠ±ç»´æŒæˆ˜æ–—æµ (Flow) çš„ç©å®¶ã€‚

---

## 6. å¼•ç”¨ä¸å‚è€ƒ (References)

*   **æ•°å€¼ä½“ç³»**: è¯¦è§ `Design/Numerical_Manual.md` (PRD å¸¸æ•°è¡¨ã€å®Œæ•´ä¼¤å®³å…¬å¼)ã€‚
*   **ä»£ç å®ç°**:
    *   ä¼¤å®³è®¡ç®—: `Code/Combat/DamageCalculator.cs` (å¾…å®ç°)
    *   çŠ¶æ€ç®¡ç†: `Code/Combat/StatusSystem.cs` (å¾…å®ç°)
    *   éŸ§æ€§é€»è¾‘: `Code/Combat/PoiseSystem.cs` (å¾…å®ç°)