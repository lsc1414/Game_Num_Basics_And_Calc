# 🎲 肉鸽强化系统 (Roguelike Perks & Boons)

本文档定义了局内成长系统（Level Up Bonuses），这是 Roguelike 体验的核心，决定了单局游戏的重玩价值。

---

## 💎 核心设计哲学 (Core Design Philosophy)

### 🎯 为什么Roguelike强化系统如此重要？

Roguelike强化系统（Perk/Boon系统）是**单局内成长**的引擎，它决定了：

1. **重玩价值（Replay Value）** - 玩家每局体验完全不同
2. **涌现性玩法（Emergent Gameplay）** - 随机组合创造意外惊喜
3. **梯度难度曲线** - 随着强化叠加，玩家从弱到强的爽快感
4. **策略深度** - 不是简单的数值堆砌，而是动态构建Build

#### 🧠 心理学基础：多巴胺分泌曲线

优秀的Perk系统设计需要契合玩家的**心流状态（Flow）**：

```
焦虑区（Anxiety）        Flow心流区           厌倦区（Boredom）
       ↑                       |                      ↑
难度过高            挑战与能力匹配              难度过低
无强化感              高频正反馈                单调重复
```

**关键设计原则：**
- **即时反馈（Immediate Feedback）** - 获得强化后立刻感受到数值/机制变化
- **可见的成长（Visible Growth）** - 通过UI、特效、击杀效率让玩家感知到自己在变强
- **选择的幻象（Illusion of Choice）** - 三选一不是真的"随机",而是通过算法引导玩家走向完整Build

#### 🎮 "Build"是什么？为什么玩家追求它？

一个完整的Build = **核心机制（Core Mechanic）+ 放大器（Amplifiers）+ 触发器（Triggers）**

以《Hades》为例:
```
核心机制: 宙斯的闪电攻击（普攻附带链式闪电）
   ↓
放大器: 爱神的虚弱（被闪电击中的敌人受到伤害+30%）
   ↓
触发器: 阿尔特弥斯的暴击（造成暴击后，周围敌人也会被链电）
```

这个三角结构一旦成型，玩家看到的不是三个独立效果，而是一个**协同运转的生态系统**。这就是Build的"Aha Moment"(顿悟时刻)。

#### ⚖️ 避免"假选择"（False Choice）

**什么是假选择？**
- +5%攻击力 vs +5%生命值（两者都平庸，没有方向性）
- 拿了"火伤+30%"不拿"火伤"技能（选项与当前Build无关）
- 拿过1次后不想再拿的普适性强化（如"伤害+10%"）

**解决方案：**
1. **标签化池子（Tagged Pools）** - Perk按流派分类，引导玩家选择方向
2. **软锁机制（Soft Lock）** - 不ban掉无关选项，但降低权重
3. **上限设计（Cap）** - 普适性强化叠加3~5次后从池子中移除

#### 🎲 输入随机性 vs 输出随机性

Roguelike的魅力在于**输入随机性**（玩家行动前的随机）：
- "这把给我三个Perk，我该如何选择？"
- "我的Build需要火伤，但出了冰伤，是否要转Build？"

而**输出随机性**（行动后的随机）应该被严格控制：
- 暴击率不应该像赌博，而是稳定的期望收益
- 这就是为什么使用**PRD算法**（Pseudo-Random Distribution）

**《杀戮尖塔》（Slay the Spire）** 是输入随机性的典范：
- 抽牌顺序是随机的 = 输入随机性 = 策略的源泉
- 但卡牌效果本身没有随机 = 输出稳定 = 技术可验证

#### 🏆 为什么要使Build"成型"和"通关"之间存在差距？

这个差距是**Roguelike的核心循环**：

```
期望 Build 成型 ←─────────┐
      ↓                    │
实际 Build 残缺  →  失败 → 再来一局（价值感）
      ↓                    │
凑齐关键组件 ←─────────┘
```

如果Build太容易成型，玩家会：
- 过早感到无聊
- 失去"就差一个"的紧张感
- 每局体验趋同

**经典案例《吸血鬼幸存者》（Vampire Survivors）**:
- 开局弱小，几乎无法生存
- 拿到3-4个关键Perk后开始起飞
- 但还需要5-6个Perk才能完全成型
- 这种"从地狱到天堂"的梯度是核心爽点

---

## 1. 系统概述 (Overview)

*   **获取方式:** 角色升级 (EXP)、通过精英波次、打开诅咒宝箱。
*   **选择机制:** 典型的“三选一” (Drafting)。
*   **稀有度:** 普通 (Common) < 稀有 (Rare) < 史诗 (Epic) < 传说 (Legendary)。

## 2. 强化词条分类 (Perk Categories)

为了防止池子太杂，Perk 被分为标签化的“池子”。

### 2.1 基础属性类 (Stat Boosts)
*最通用，权重最高，但由于边际效应递减，后期收益低。*
*   **蛮力 (Brutality):** 增加 10% 物理伤害。
*   **迅捷 (Alacrity):** 增加 8% 攻击速度。
*   **坚韧 (Tenacity):** 增加 10% 最大生命值。

### 2.2 机制质变类 (Mechanic Alterations) - *传说级*
*这类 Perk 会改变玩法逻辑。*
*   **血魔法 (Blood Magic):** 技能不再消耗法力，改为消耗生命值。技能伤害 +30%。
*   **多重投射 (Multishot):** 投射物数量 +2，但伤害修正为 60%。
*   **连锁反应 (Chain Reaction):** 暴击时有 50% 几率触发闪电链。

### 2.3 塔防协同类 (Tower Synergy)
*强化“塔”与“人”的连接。*
*   **工匠精神 (Artificer):** 站在塔周围 5米 内，角色和塔的攻速都 +15%。
*   **废料回收 (Scrapper):** 敌人死在塔的射程内，掉落 Scrap 增加 20%。

## 3. 诅咒系统 (Curses)

高风险高回报机制。通常来源于“诅咒宝箱”或特殊祭坛。
*   **格式:** 获得一个强力 Buff，但永久背负一个 Debuff。
    *   *例子:* **玻璃大炮 (Glass Cannon):** 造成伤害 +50%，但受到的伤害 +50%。
    *   *例子:* **重力场 (Gravity):** 移速 -20%，但周围敌人也会被减速 20%。

## 2.4 设计理论：构建深度 (Design Theory)

优秀的 Roguelike 系统不仅仅是随机给属性，而是引导玩家进行**动态规划**。

### A. 协同效应 (Synergy)
核心目标是让 `1 + 1 > 2`。
*   **加法协同:** 火焰伤害 + 火焰伤害 = 更高的火焰伤害。
*   **乘法协同 (关键):** 攻击附加流血 (Bleed) + 对流血敌人必定暴击 (Crit on Bleed)。这两个机制独立存在时平平无奇，组合在一起时产生质变。
*   **反协同 (Anti-Synergy):** 必须小心避免。例如：“生命值越低伤害越高” + “自动回血”。这会导致玩家不仅没有变强，反而机制互斥。

### B. 随机性类型
*   **输入随机性 (Input Randomness):** 玩家在行动前面临的随机情况（如 Perk 三选一）。这是策略的来源，玩家需要根据手牌做最优解。
*   **输出随机性 (Output Randomness):** 玩家行动后的结果（如 20% 几率暴击）。过高的输出随机性会导致“运气游戏”，应通过 **PRD 算法** 控制。

### C. 成型速度 (Build Velocity)
*   **线性构建:** 每拿一个 Perk 变强一点。稳定但平庸。
*   **指数构建 (Exodia):** 需要凑齐 A, B, C 三个组件才能生效，一旦凑齐直接通关。
    *   设计者需要控制 Key 组件的出现率，让“凑齐”成为一种高风险高回报的赌博。

---

## 📚 业界优秀案例分析 (Case Studies)

### 🏆 《Hades》—— 叙事与强化融合的艺术

**设计理念：** Perk不仅仅是数值，更是推动剧情和角色关系的工具

**核心机制：**
- **希腊众神祝福系统**：每位神明代表一个完整体系(如宙斯=闪电、雅典娜=反弹)
- **双重祝福( legendary/duos )**：需要两个神明的体系都投资才能解锁的最强Perk
- **叙事权重**：Perk选择伴随着角色对话，强化世界观沉浸感

**设计亮点：**
1. **"保底机制"**：如果15次选择都没有出现某个神明的祝福，系统会强制触发
2. **流派完整性**：每个神明体系内部有完整逻辑(Jolted→Static Discharge→Double Strike)
3. **软锁定**：拿了宙斯后，雅典娜祝福权重下降，但仍有小概率出现(保持惊喜感)

**数据洞察：**
- 共10位主神 + 3位次神
- 每位神明平均有8-10个Perk，保证多样性
- Duo祝福仅6个，极低概率但极强效果 = "Exodia"设计

**学习要点：**
- Perk可以承载叙事功能，不仅仅是系统层面
- 软锁定比硬禁止更能创造"意外惊喜"
- 体系间联动(Duo)比单一体系叠加更有趣

---

### 🃏 《Slay the Spire》—— 卡牌构筑的极致随机控制

**设计理念：** 输入随机性的教科书案例

**核心机制：**
- **抽牌堆机制**：卡牌获得后进入牌库，意味着"稀释"风险
- **开始牌必须消失**：所有"Strike"(攻击)和"Defend"(防御)都是可以删除的
- **遗物与卡牌的协同**：遗物是被动，卡牌是主动，两者互相放大

**设计亮点：**
1. **"脏牌"概念**：诅咒牌和状态牌会污染牌堆，迫使玩家拿"烧牌"卡
2. **路径选择与强化节点分离**：强化不随机，但何时获得是随机
3. **稀有度不等于强度**：稀有卡往往有复杂效果，但不一定适合当前Build

**数据洞察：**
- 4个角色 × 75+卡牌 = 300+独特卡牌
- 稀有度分布：普通(70%) > 罕见(25%) > 稀有(5%)
- 遗物共180+，保证了几乎每局都有新组合

**学习要点：**
- 获得强化 ≠ 变强，可能污染牌库(复杂度提升)
- 删除/精简是Build的重要组成部分
- 路径规划(什么时间拿牌)与选择什么牌同样重要

---

### 🧬 《Dead Cells》—— 局外成长与局内强化分离

**设计理念：** 区分"单局体验"与"账号成长"

**核心机制：**
- **卷轴系统**：每局只能3选1(红/紫/绿)，决定主属性
- **无随机池**：所有武器/技能都可以在当前世界掉落(全池可刷)
- **关键词协同**："Oil」+「Fire」=燃烧，「Ice」+「Lightning」=连锁

**设计亮点：**
1. **颜色锁定**：拿了红色卷轴后，只有红色武器受益 = 强制流派化
2. **自定义模式**：玩家可以ban掉不想要的内容，减少挫败感
3. **词缀重铸**：局内可以花费金币重铸装备词缀 = 给玩家"反悔"机会

**学习要点：**
- 颜色/流派锁定强，但局内重铸机制造容错
- 局外解锁新物品 ≠ 局内掉落，需要控制池子大小
- 关键词组合(Oil+Fire)比纯数值叠加更有趣

---

### 🎮 《Vampire Survivors》—— 极简主义与梯度爽感

**设计理念：** 让玩家从"弱"到"超神"必须有明显的阶段感

**核心机制：**
- **超简选择**：每次升级只有3个选项，没有复杂UI
- **合成系统**：特定Perk组合后自动升级为"超级武器"
- **武器与配件分离**：主武器(输出) + 配件(辅助) = 需要凑齐两者

**设计亮点：**
1. **开局地狱模式**：0强化时几乎无法生存 → 强烈的成长对比
2. **指数级堆叠**：每拿一个Perk就感觉强了一个档次
3. **视觉噪音=爽感**：满屏敌人和子弹 = 玩家感受到自己的强大

**数据洞察：**
- 基础武器11种 × 配件16种 = 176种组合可能性
- 实际上线时只有19个超级武器(控制成型路径)
- 每局平均收集15-20个Perk = 高频正反馈

**学习要点：**
- 简单选择 ≠ 简单策略，组合空间足够大
- 梯度要明显：开局痛苦 → 中期能活 → 后期割草
- 合成/进化是强激励，特别是需要2-3个组件时

---

### 🗡️ 《Path of Exile》—— 复杂度与自由度极限

**设计理念：** 为硬核玩家提供最复杂的构建系统

**核心机制：**
- **天赋树**：1400+节点的巨大网络
- **Keystone天赋**：改变底层规则(如"血魔法"扣分加攻)
- **技能石系统**：主动技能是物品，可插宝石增强

**设计亮点：**
1. **规则改变者**：20+Keystone，每个都彻底颠覆玩法
2. **无限可能**：天赋树允许理论上所有流派
3. **经济驱动**：绝大部分好Perk/物品需要通过交易获得

**学习要点：**
- 复杂度本身是吸引力(目标玩家清晰)
- Keystone类机制改变型Perk是传说级Perk设计的标杆
- 需要配套工具(Path of Building)辅助玩家规划 = 复杂度补偿

---

### 📊 案例共性总结

所有优秀的Roguelike强化系统都具备：

| 特性 | Hades | Slay the Spire | Dead Cells | Vampire Survivors | PoE |
|------|-------|----------------|------------|-------------------|-----|
| **输入随机性** | ✅ 高 | ✅ 极高 | ✅ 中 | ✅ 中 | ✅ 低 |
| **输出随机性** | ⚠️ 有暴击 | ✅ 极低 | ✅ 极低 | ✅ 极低 | ⚠️ 复杂 |
| **流派锁定** | ✅ 软锁定 | ✅ 卡组定义 | ✅ 颜色锁定 | ✅ 合成路径 | ✅ 天赋树 |
| **组件联动** | ✅ Duo祝福 | ✅ 卡牌组合 | ✅ 关键词 | ✅ 武器+配件 | ✅ 支撑宝石 |
| **梯度爽感** | ✅ 明显 | ✅ 中 | ✅ 高 | ✅ 极高 | ✅ 中 |
| **复杂度** | 中 | 高 | 中 | 极低 | 极高 |

**核心启示：**
1. **复杂度必须与目标玩家匹配** - 不要试图取悦所有人
2. **简单的表面 + 深度的内核** 是最佳配方(Vampire Survivors典范)
3. **输入随机性**是Roguelike的灵魂，输出随机性是敌人
4. **联动机制(Key+Amplifier+Trigger)**比纯数值叠加有趣10倍

---

## 🔬 深入设计理论 (Advanced Design Theory)

### 🧩 协同效应的三种类型 (Types of Synergies)

基于上述案例分析，协同效应可分为：

#### 1️⃣ 线性叠加 (Linear Stacking)
- **机制：** 同一效果的简单相加
- **公式：** `效果A + 效果B = 更强的效果A`
- **例子：** 火伤+10% + 火伤+10% = 火伤+20%
- **设计风险：** 后期边际效应递减严重，玩家会觉得无聊
- **解决方案：** 设置软上限，或转化为乘法

#### 2️⃣ 乘法放大 (Multiplicative Amplification)
- **机制：** 两个独立机制互相放大
- **公式：** `(1 + 效果A) × (1 + 效果B) = 远大于预期的效果`
- **例子：** 攻击附加流血 + 对流血敌人100%暴击率 = 伤害 × 2倍以上
- **设计价值：** 这才是Build的"Aha Moment"来源
- **设计风险：** 容易被玩家发现最优解，导致每局Build趋同
- **平衡手段：** 故意设置互斥选项，只能选其一

#### 3️⃣ 组合质变 (Combination Evolution)
- **机制：** A + B 生成全新的 C
- **公式：** `效果A + 效果B → 新效果C(远强于A+B)`
- **例子：** **《Vampire Survivors》**的进化系统：武器+对应配件 = 超级武器
- **设计价值：** 给玩家强烈的收集激励，制造"就差一个"的紧张感
- **黄金比例：** 进化类Perk应占总池的10-15%，太多会导致游戏混乱

---

### ⚖️ 平衡性设计原则 (Balancing Principles)

#### 1️⃣ 数值平衡三支柱

**Pillar 1: 单卡价值 (Card Value)**
- **定义：** 单个Perk的独立强度
- **测试方法：** 让测试员只拿这个Perk，评估其对强度的提升
- **标准：**
  - Common: 10-15%强度提升
  - Rare: 20-30%强度提升
  - Epic: 35-50%强度提升
  - Legendary: 60-100%+或机制改变

**Pillar 2: 协同溢价 (Synergy Premium)**
- **定义：** Perk组合后的额外价值
- **关键公式：**
```
实际价值 = 单卡价值 × (1 + 协同系数)^n
其中 n = 与当前Build的协同Perk数量
协同系数(推荐值):
- 弱协同(同标签)：0.1
- 中等协同(机制配合)：0.25
- 强协同(核心组件)：0.5
```
- **设计原则：** 强协同Perk的基础数值应该故意低于平均水平，避免"无脑强"

**Pillar 3: 机会成本 (Opportunity Cost)**
- **定义：** 选择A而放弃B、C的成本
- **核心问题：** "这个Perk是否值得我放弃另外两次选择机会？"
- **评估标准：**
  - 普适性越高，机会成本越低（但超过3次后价值递减）
  - 专精性越高，机会成本越高（但成型后价值爆炸）
- **设计技巧：** 故意在 B、C 中放置一个"假选择"，提高A的吸引力

#### 2️⃣ 难度曲线对齐

Perk的强度曲线必须与游戏的难度曲线匹配：

```
游戏难度: ────────▲─────────────▲─────────────▲────→
            波次1-5   精英波   波次10-15   Boss   后期
               低       中         高      极高     降速

Perk强度: ────────▲────▲────▲────▲────▲────▲────▲──→
            第1次  第2次 第3次 第4次 第5次 第6次 第7次 第8次
            +15%  +15% +20% +25% +30% +25% +20% +15%
          基础Perk → 核心 → 放大 → 收尾
```

**关键洞察：**
- 最后几个选择的强度应该刻意降低，避免"最后一抽翻盘"
- Boss前1-2个选择应该是"防御/生存"向，帮助玩家过Boss
- 后期曲线下降 → 防止"过于强大"导致游戏失去挑战性

#### 3️⃣ 常见平衡陷阱

**陷阱 1: "雪球效应" (Snowballing)**
- **症状：** 前期拿好Perk → 击杀快 → 升级快 → 更多Perk → 完全碾压
- **解决方案：**
  - 等级经验需求指数增长
  - 怪物强度与玩家等级挂钩(Dynamic Difficulty Adjustment)
  - 限制最高等级(如20级封顶)

**陷阱 2: "死胡同Build" (Dead-end Build)**
- **症状：** 玩家拿了一手看似不错但无法协同的Perk，后期完全打不动
- **检测方法：**
  ```python
  # 伪代码：死胡同检测
  def is_dead_end_build(current_perks):
      dmg_perks = count_damage_perks(current_perks)
      def_perks = count_defense_perks(current_perks)
      synergy_score = calculate_synergy(current_perks)

      if dmg_perks < 3 and def_perks < 3:
          return True  # 输出和防御都不足
      if synergy_score < 1.5 and len(current_perks) > 5:
          return True  # 后期协同差
      return False
  ```
- **解决方案：**
  - 当系统检测到玩家Build不健康时，提高"补救性Perk"的权重
  - 补救性Perk：防御、逃跑、范围伤害等通用性强内容

**陷阱 3: "最优解" (Optimal Build)**
- **症状：** 社区很快发现一个"无敌Build"，所有玩家都抄作业
- **根本问题：** 设计时没有设置互斥选项
- **解决方案：**
  - 核心组件无法共存(如选了"血魔法"就不能选"法力护盾")
  - 定期热更新调整数值(nerf过强的，buff冷门的)
  - 引入"变异因子"(如这局"火伤-50%"，迫使玩家换Build)

---

### 🧪 测试与调优方法论 (Testing Methodology)

#### 双循环测试法

**循环 1: 单Perk强度测试** ⏱️ 每日自动化
```
对每个Perk:
  运行100次模拟战斗
  记录：胜率、平均通关时间、DPS、生存时间
  标记异常值(胜率>80% 或 <20%)
```

**循环 2: Build完整性测试** ⏱️ 每周人工
```
招募10名测试员，给定目标Build
记录：
  - 多久能凑齐关键组件
  - 凑齐后的强度感受(1-10分)
  - 未凑齐时的挫败感(1-10分)
  - 是否愿意再来一局
```

#### 数据指标监控

**必须追踪的KPI：**

| 指标 | 健康范围 | 警告阈值 | 危险阈值 |
|------|---------|---------|---------|
| 单卡选择率 | 5-20% | >30% | >40% |
| Build完成率 | 15-30% | <10% | <5% |
| 重复游玩率 | 3-10次/人 | >20次 | >50次(可能卡在某一阶段) |
| 平均选择时长 | 10-30秒 | <5秒(无脑选) | >60秒(选择困难) |

**选择题优化：**
- 如果平均时长<5秒，说明某Perk过于强势(无脑选)
- 如果平均时长>60秒，说明三个选项价值相近或都差(挫败感)

#### 快速迭代流程

```
Day 1: 玩家反馈 "XX Perk 太弱"
Day 2: 查看数据，确认选择率 < 5%
Day 3: 决定：数值提升30% or 降低稀有度
Day 4: 热更新上线
Day 5: 观察数据，选择率提升至8% = 成功

周期：3-5天一个迭代
```

**A/B测试：**
- 50%玩家看到版本A(旧数值)
- 50%玩家看到版本B(新数值)
- 24小时后对比数据，决定全量推送哪个版本

---

## 3. 进阶词条库 (Advanced Perk Pool)

为了支撑上述理论，我们需要设计多种类型的 Perk。

### 3.1 条件触发类 (Conditional)
*这类 Perk 极度依赖操作或特定状态。*
*   **满血专注 (Perfect Focus):** 当生命值满时，暴击率 +50%。(鼓励无伤操作)
*   **绝境反击 (Last Stand):** 生命值低于 30% 时，获得 50% 减伤和吸血。(防猝死)
*   **距离法则 (Long Shot):** 距离目标越远，伤害越高（最大 +40%）。
*   **运动战 (Moving Target):** 移动时造成的伤害 +25%，受到的伤害 -10%。
*   **巨人杀手 (Slayer):** 对精英 (Elite) 和首领 (Boss) 造成的伤害 +30%。

### 3.2 转化类 (Transformative)
*改变属性的底层逻辑，通常参考《流放之路》的关键天赋。*
*   **护甲转攻 (Spiked Armor):** 失去所有护甲值，将其转化为攻击力。
*   **以血换蓝 (Blood Magic):** 移除法力槽，所有技能消耗生命值。
*   **控制质变 (Deep Freeze):** 冰冻效果不再定身敌人，改为使敌人受到的伤害 +50%。
*   **异能电池 (Eldritch Battery):** 能量护盾 (Energy Shield) 不再保护生命值，改为保护法力值。
*   **灵能掠夺 (Ghost Reaver):** 生命偷取 (Life Leech) 效果改为回复能量护盾。

### 3.3 经济类 (Economy)
*   **利滚利 (Compound Interest):** 每波结束时，获得当前金币 10% 的利息（上限 100）。
*   **贪婪之手 (Greed):** 拾取范围 +100%，金币掉落量 +20%，但敌人攻击力 +10%。

### 3.4 元素反应类 (Elemental Reactions)
*奖励混合构建，鼓励“打配合”。*
*   **热休克 (Thermal Shock):** 对燃烧 (Burning) 状态的敌人造成冰霜 (Cold) 伤害时，触发一次 200% 范围爆炸。
*   **超导 (Conductive):** 浸湿 (Soaked) 状态的敌人受到闪电 (Lightning) 伤害增加 50%。
*   **结晶化 (Crystallize):** 冻结敌人时，生成一个可拾取的护盾碎片，回复 5% 护盾值。

### 3.5 召唤/塔防类 (Summon/Tower)
*强化防御塔与召唤物，适合“工程师”流派。*
*   **超频模式 (Overclock):** 所有防御塔攻速 +50%，但每秒受到 5% 最大生命值的真实伤害（需配合维修）。
*   **完美回收 (Recycling):** 拆除防御塔时返还 100% 资源（原为 50%），并回复玩家 10% 生命值。
*   **蜂群思维 (Hive Mind):** 所有防御塔优先攻击玩家当前锁定的目标，且对该目标伤害 +20%。

### 3.6 移动与闪避类 (Movement & Evasion)
*强化机动性与生存能力。*
*   **相位偏移 (Phase Shift):** 冲刺 (Dash) 时在原地留下一个持续 3秒 的诱饵，嘲讽周围敌人。
*   **动能转化 (Momentum):** 移动速度加成的 50% 转化为攻击力加成。
*   **静电场 (Static Field):** 移动时积攒电荷（最高 100层）；停止移动时释放震荡波，消耗层数造成范围晕眩。

---

## 4. 随机权重与算法 (RNG Algorithms)

为了避免纯随机导致的体验崩溃，我们采用以下控制算法。

### 4.1 抽卡袋机制 (Bag System / Deck of Cards)
不仅仅是随机，而是类似俄罗斯方块的随机。
*   将 Perk 池视为一副牌。
*   每抽走一张，牌堆里就少一张。
*   **效果:** 避免了连续 10 次都不出攻击力，或者连续 10 次都出同一个垃圾 Perk 的情况。

### 4.2 标签偏好 (Tag Biasing)
*   如果玩家选择了 `[Fire]` 标签的 Perk，系统会将所有带有 `[Fire]` 标签的 Perk 权重乘以 `1.5`。
*   这模拟了“发牌员懂我”的体验，帮助玩家更容易凑出 Build。

### 4.3 封印机制 (Ban System)
*   某些互斥的流派（如“近战”与“远程”），一旦玩家选择了“近战专精”，系统应自动降低或**封印 (Ban)** “远程专精”的出现，避免污染卡池。

---

## 5. 视觉与反馈 (Visuals & Feedback)

Perk 选择界面是玩家最期待的时刻，必须有强烈的多巴胺反馈。

*   **稀有度光效:**
    *   **普通 (Common):** ⚪ 白色/灰色框。
    *   **稀有 (Rare):** 🔵 蓝色流光。
    *   **史诗 (Epic):** 🟣 紫色脉冲。
    *   **传说 (Legendary):** 🟠 金色火焰特效，伴随重音音效。
*   **UX 标识:**
    *   **[New]**: 玩家从未选过的 Perk，鼓励尝试。
    *   **[Synergy]**: 检测到与当前已有 Perk 存在强协同，显示绿色向上箭头。
    *   **[Maxed]**: 该 Perk 已达最大堆叠层数。

---

## 6. 数据结构参考 (JSON)

```json
{
  "id": "Perk_BloodMagic",
  "name": "Blood Magic",
  "rarity": "Legendary",
  "tags": ["Mana", "Life", "Keystone"],
  "max_stacks": 1,
  "conflicts": ["Perk_ManaShield", "Perk_EnergyRegen"],
  "description": "Skills cost Life instead of Mana. Deal <c=val>{0}</c>% more Damage.",
  "description_args": [30],
  "modifiers": [
    { "stat": "ManaCost", "value": -100, "type": "More" },
    { "stat": "CostType", "value": "Life", "type": "Override" },
    { "stat": "GlobalDamage", "value": 0.3, "type": "More" }
  ],
  "weight": 50,
  "synergy_tags": ["High_Regen_Build"]
}
```

---

## 📚 扩展阅读与设计灵感 (References)

### 🎲 随机性与设计
*   **[Game Maker's Toolkit: The Two Types of Random](https://www.youtube.com/watch?v=dwI5b-wRLic)**
    *   Mark Brown 深度解析 Input Randomness vs Output Randomness。
*   **[Hades Developer Blog: Controlling Randomness](https://www.supergiantgames.com/blog/)**
    *   Supergiant 如何在 Hades 中通过 "God Mode" 和 Pity Timers 控制玩家体验。

### 🃏 牌库构建 (Deck Building)
*   **[Slay the Spire: Balancing a Deck Builder](https://www.gdcvault.com/play/1025775/Slay-the-Spire-Metrics-Driven)** (GDC 2019)
    *   Mega Crit 团队分享如何通过数据分析来平衡 300+ 张卡牌。
*   **[Magic: The Gathering Design Articles](https://magic.wizards.com/en/articles/archive/making-magic/timmy-johnny-and-spike-2013-12-03)**
    *   万智牌首席设计师 Mark Rosewater 的经典文章，定义了 Timmy, Johnny, Spike 三种玩家类型，对设计 Perk 非常有启发。

### 🧠 涌现性玩法 (Emergent Gameplay)
*   **[Systemic Games: 5 Key Elements](https://www.gamasutra.com/blogs/TynanSylvester/20130602/193462/The_Design_of_RimWorld.php)**
    *   RimWorld 开发者 Tynan Sylvester 讲解如何通过简单的规则组合创造出复杂的涌现性玩法。