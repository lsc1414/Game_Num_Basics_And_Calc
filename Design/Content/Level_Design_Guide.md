# 🗺️ 关卡与波次设计指南 (Level Design & Wave Pacing)

本文档指导如何构建游戏地图以及控制刷怪节奏 (Pacing)。

---

## 1. 地图生成逻辑 (Map Generation)

本作不使用完全随机的迷宫，而采用 **“模块化拼图” (Modular Tiles)** 系统，兼顾战术深度与随机性。

### 1.1 核心结构
*   **基地 (Hub):** 地图中心，不可破坏，玩家必须守护的核心。
*   **主路 (Lanes):** 连接刷怪点 (Spawners) 和基地的主要路径。
*   **空地 (Plots):** 允许玩家建造防御塔的区域。
    *   *高地 (High Ground):* 放置在此处的塔获得 +20% 射程。
    *   *能量节点 (Power Nodes):* 放置在此处的塔攻速 +30%，但造价翻倍。

### 1.2 地形阻挡与迷宫 (Mazing)
*   地图初始是开放的。
*   玩家可以通过建造“墙壁”或“阻挡塔”来改变怪物的寻路。
*   **限制:** 系统必须保证至少有一条从刷怪点到基地的通路（不能完全堵死）。如果完全堵死，怪物进入“狂暴模式”，攻击力翻倍并开始拆墙。

## 2. 波次节奏控制 (Wave Pacing)

一局游戏标准时长为 20 分钟，分为若干波次。

### 2.1 强度曲线 (Intensity Curve)
*   采用 **正弦波** 模式：
    *   *Build Up:* 少量杂兵，给玩家送钱造塔。
    *   *Peak:* 高密度刷怪，混合精英。
    *   *Climax:* Boss 战或超高压波次。
    *   *Rest:* 只有零星小怪，给玩家整理装备、升级塔的时间。

### 2.2 刷怪配置 (Spawn Patterns)
*   **线性流 (Stream):** 连续不断地刷单一兵种。测试单体输出。
*   **爆发流 (Burst):** 瞬间刷出一大群低血量怪。测试 AoE 能力。
*   **钳形攻势 (Pincer):** 两个相反方向的刷怪点同时激活。强迫玩家分兵或构建全向防御。

## 3. 动态难度调整 (Dynamic Difficulty - Director)

参考《求生之路》的 AI Director。

*   **监测指标:** 玩家血量、塔的损毁率、DPS 统计。
*   **调整:**
    *   如果玩家过于轻松（满血，塔未受损），下一波提前刷新，或者增加精英怪数量。
    *   如果玩家濒死，下一波刷怪间隔延长，或掉落回复球。

## 4. 地图事件 (Map Events)

为了打破枯燥，随机触发地图事件。

*   **血月 (Blood Moon):** 所有怪物攻速 +30%，但掉落稀有度提升。
*   **虚空裂隙 (Void Rift):** 地图随机位置开启传送门，刷出偷袭基地的怪物。玩家必须去关闭它。
*   **流浪商队 (Wandering Trader):** 一个无敌的 NPC 经过地图，玩家可以购买急需的消耗品。

---

## 5. 关卡 JSON 示例

```json
{
  "level_id": "Lvl_Graveyard_01",
  "waves": [
    {
      "time_start": 0,
      "duration": 60,
      "spawners": ["North", "South"],
      "enemies": [
        {"id": "Zombie", "count": 50, "interval": 1.0},
        {"id": "Skeleton_Archer", "count": 10, "interval": 5.0}
      ]
    },
    {
      "time_start": 70,
      "type": "Rest",
      "duration": 30
    }
  ]
}
```
